apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Values.deployment.name | quote }}
spec:
  replicas: {{ .Values.deployment.replicas | default 1 }}
  selector:
    matchLabels:
      service: {{ .Values.deployment.name | quote }}
  template:
    metadata:
      annotations: {{ .Values.deployment.annotations | toYaml | nindent 8 }}
      labels: {{ .Values.deployment.labels | toYaml | nindent 8 }}
    spec:
      affinity: {{- .Values.deployment.affinity | toYaml | nindent 8 }}
      tolerations: {{- .Values.deployment.tolerations | toYaml | nindent 8 }}
      nodeSelector: {{- toYaml .Values.deployment.nodeSelector | nindent 8 }}
      containers:
        - name: {{ .Values.deployment.name | quote }}
          image:  "{{ .Values.deployment.image.repository }}:{{ .Values.deployment.image.tag }}"
          imagePullPolicy: {{ .Values.deployment.image.pullPolicy | default "IfNotPresent" | quote }}
          env: {{ .Values.deployment.env | toYaml | nindent 12 }}
